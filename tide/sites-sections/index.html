



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Documentation for Single Digital Presence">
      
      
        <link rel="canonical" href="https://dpc-sdp.github.io/sdp-docs/tide/sites-sections/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>Sites and sections - Single Digital Presence</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#3f51b5">
      
    
    
      <script src="../../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#sites-and-sections" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://dpc-sdp.github.io/sdp-docs/" title="Single Digital Presence" class="md-header-nav__button md-logo">
          
            <img src="../../images/logo.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Single Digital Presence
            </span>
            <span class="md-header-nav__topic">
              Sites and sections
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/dpc-sdp/sdp-docs" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    dpc-sdp/sdp-docs
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
        

  

<nav class="md-tabs md-tabs--active" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  <li class="md-tabs__item">
    
      <a href="../.." title="About" class="md-tabs__link">
        About
      </a>
    
  </li>

      
        
      
        
      
        
      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../bay/" title="Bay" class="md-tabs__link">
          Bay
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../" title="Tide" class="md-tabs__link md-tabs__link--active">
          Tide
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../ripple/" title="Ripple" class="md-tabs__link">
          Ripple
        </a>
      
    </li>
  

      
        
  
  
    <li class="md-tabs__item">
      
        <a href="../../development/" title="Development" class="md-tabs__link">
          Development
        </a>
      
    </li>
  

      
    </ul>
  </div>
</nav>
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://dpc-sdp.github.io/sdp-docs/" title="Single Digital Presence" class="md-nav__button md-logo">
      
        <img src="../../images/logo.svg" width="48" height="48">
      
    </a>
    Single Digital Presence
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/dpc-sdp/sdp-docs" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    dpc-sdp/sdp-docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="About" class="md-nav__link">
      About
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../terminology/" title="Terminology" class="md-nav__link">
      Terminology
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../architecture/" title="Architecture" class="md-nav__link">
      Architecture
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Bay
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Bay
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../bay/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bay/onboarding/" title="Onboarding *" class="md-nav__link">
      Onboarding *
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bay/preview-environments/" title="Preview environments" class="md-nav__link">
      Preview environments
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../bay/search/" title="Search *" class="md-nav__link">
      Search *
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Tide
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Tide
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../modules/" title="Modules" class="md-nav__link">
      Modules
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../api/" title="API" class="md-nav__link">
      API
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Sites and sections
      </label>
    
    <a href="./" title="Sites and sections" class="md-nav__link md-nav__link--active">
      Sites and sections
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-it-works" title="How it works" class="md-nav__link">
    How it works
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#site-and-section-fields" title="Site and Section Fields" class="md-nav__link">
    Site and Section Fields
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#site-menus" title="Site menus" class="md-nav__link">
    Site menus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-site-url-rendering" title="Multi-site URL rendering" class="md-nav__link">
    Multi-site URL rendering
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fields-components/" title="Fields and components" class="md-nav__link">
      Fields and components
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Ripple
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Ripple
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ripple/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ripple/components/" title="Components" class="md-nav__link">
      Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ripple/api/" title="API *" class="md-nav__link">
      API *
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ripple/search/" title="Search" class="md-nav__link">
      Search
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ripple/content-data-flow/" title="Content data flow" class="md-nav__link">
      Content data flow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ripple/setup/" title="Setup new site" class="md-nav__link">
      Setup new site
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Development
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Development
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-2" type="checkbox" id="nav-8-2">
    
    <label class="md-nav__link" for="nav-8-2">
      Content Repository
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-2">
        Content Repository
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/content-repository/setup/" title="Setup" class="md-nav__link">
      Setup
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/content-repository/local-development-environment/" title="Local development environment" class="md-nav__link">
      Local development environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/content-repository/automated-builds/" title="Automated builds" class="md-nav__link">
      Automated builds
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/content-repository/coding-standards/" title="Coding standards" class="md-nav__link">
      Coding standards
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/content-repository/module-development/" title="Module Development *" class="md-nav__link">
      Module Development *
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/content-repository/readme-file/" title="README.md file" class="md-nav__link">
      README.md file
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8-3" type="checkbox" id="nav-8-3">
    
    <label class="md-nav__link" for="nav-8-3">
      Frontend Website
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-8-3">
        Frontend Website
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/frontend-website/setup/" title="Setup *" class="md-nav__link">
      Setup *
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/frontend-website/style-guide/" title="Style guide" class="md-nav__link">
      Style guide
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/frontend-website/local-development-environment/" title="Local development environment" class="md-nav__link">
      Local development environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/frontend-website/automated-builds/" title="Automated builds" class="md-nav__link">
      Automated builds
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/frontend-website/coding-standards/" title="Coding standards" class="md-nav__link">
      Coding standards
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/frontend-website/component-development/" title="Component Development *" class="md-nav__link">
      Component Development *
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/frontend-website/readme-file/" title="README.md file" class="md-nav__link">
      README.md file
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/workflow/" title="Development workflow" class="md-nav__link">
      Development workflow
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/code-review/" title="Code review" class="md-nav__link">
      Code review
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/release/" title="Release management" class="md-nav__link">
      Release management
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/accessibility/" title="Accessibility" class="md-nav__link">
      Accessibility
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/troubleshooting/" title="Troubleshooting" class="md-nav__link">
      Troubleshooting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../development/documentation/" title="Maintaining this documentation" class="md-nav__link">
      Maintaining this documentation
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#how-it-works" title="How it works" class="md-nav__link">
    How it works
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#site-and-section-fields" title="Site and Section Fields" class="md-nav__link">
    Site and Section Fields
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#site-menus" title="Site menus" class="md-nav__link">
    Site menus
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#multi-site-url-rendering" title="Multi-site URL rendering" class="md-nav__link">
    Multi-site URL rendering
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="sites-and-sections">Sites and sections<a class="headerlink" href="#sites-and-sections" title="Permanent link">&para;</a></h1>
<p>Content Repository supports multi-site and multi-section content publishing.
This means that a content piece may be re-used several times on multiple <em>sites</em>
and <em>sections</em> (<em>sections</em> belong to <em>sites</em>).</p>
<p><a href="https://github.com/dpc-sdp/tide_site">Tide Site</a> module provides an ability for
Editor to publish content to selected <em>sites</em> and <em>sections</em>.</p>
<h2 id="how-it-works">How it works<a class="headerlink" href="#how-it-works" title="Permanent link">&para;</a></h2>
<p><em>Sites</em> and <em>sections</em> defined in a single vocabulary <code>Sites</code> with the maximum
depth of 1, making root-level terms to become <em>sites</em> and terms of depth level 1
to become <em>sections</em>. The module has code to provide back-end validation to
prevent creating of terms with depth more than 1.</p>
<p>We decided to use Drupal taxonomy for sites and sections for multiple
reasons: </p>
<ul>
<li>Taxonomy terms are fieldable entities. This means that Frontend Websites can
extend per-site properties as required, exposing them to the API.</li>
<li>Taxonomy terms support hierarchy, which helps to define site-section
relationship, and, as a result of this, easily filter associated content by 
site.</li>
<li>Taxonomy terms can be selected in UI using one of the existing contributed 
widgets.</li>
<li>Taxonomy terms have full Token and Pathauto support, which makes it easy 
to use them for building content URLs based on IA.</li>
<li>Taxonomy terms have full JSONAPI support and can be queried by Frontend 
  Websites in the same way as any other entities.</li>
<li>The concept of using taxonomy terms to group content is easy to understand.</li>
<li>The concept of using taxonomy terms to store per-site settings is easy to understand. </li>
</ul>
<p>Content may be shared between sites, but never between sections, as this would
lead to the same content being served from different URLs, which is highly
discouraged by search engines. </p>
<h3>Primary site</h3>
<p>To mitigate the problem when the same content is shared between different
websites, a selection of <code>Primary site</code> is required, which will be used to
generate canonical URL for the content piece. As a result, every content type
has 2 fields created automatically: <code>site</code> and <code>primary_site</code>. Both fields are
compulsory. Editors are expected to select destination site and section for each
content piece.</p>
<h2 id="site-and-section-fields">Site and Section Fields<a class="headerlink" href="#site-and-section-fields" title="Permanent link">&para;</a></h2>
<p>To provide site and section-specific information through API, every <code>Site</code> 
taxonomy term has a set of the following information fields:</p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>Domains</td>
<td>Multiline plain text field to specify site domains. This is used by Ripple to match on the domain where the request is coming from. One domain per line. Wildcards supported.</td>
</tr>
<tr>
<td>Title</td>
<td>Text field to specify site title.</td>
</tr>
<tr>
<td>Slogan</td>
<td>Text field to specify site slogan.</td>
</tr>
<tr>
<td>Logo</td>
<td>File field to upload site logo.</td>
</tr>
<tr>
<td>Footer message</td>
<td>Text field with WYSIWYG support to specify site footer message.</td>
</tr>
<tr>
<td>Main Menu</td>
<td>Per-site and per-section menus may be helpful to build section-based navigation experience. <br/><br/>  Site admins may associate existing or create new menu with every site term. <br/><br/>  This is an entity reference field.</td>
</tr>
<tr>
<td>Footer Menu</td>
<td>Per-site and per-section menus may be helpful to build section-based navigation experience. <br/><br/>  Site admins may associate existing or create new menu with every site term. <br/><br/>  This is an entity reference field.</td>
</tr>
</tbody>
</table>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Since Frontend Websites information is stored using fieldsable taxonomy terms,
it is possible to add more fields to capture site information in the Content
Repository. The data stored in these fields will become automatically 
exposed through API.  </p>
</div>
<h2 id="site-menus">Site menus<a class="headerlink" href="#site-menus" title="Permanent link">&para;</a></h2>
<p>Per-site and per-section menus may be helpful to build section-based navigation 
experience. They allow to provide custom menu items for specific sites and 
sections.  </p>
<p>Site menus automatically created when a new <code>Site</code> taxonomy term is created. </p>
<p>Basically, instead of creating a site and then manually creating a
menu on the separate screen, we automatically create and assign a menu
for each site within the site creation screen by checking relevant checkbox
on <code>Site</code> term ctreation page.</p>
<details class="note"><summary>Expand for Site menu creation flow diagram</summary><p><a href="../../assets/tide-site-menu-automated-creation.png"> <img alt="" src="../../assets/tide-site-menu-automated-creation.png" /> </a></p>
</details>
<h2 id="multi-site-url-rendering">Multi-site URL rendering<a class="headerlink" href="#multi-site-url-rendering" title="Permanent link">&para;</a></h2>
<p>When content piece belongs to multiple sites or sections, it may have links to
it from other content pieces of the current domain or other domains. Drupal has
to render these links with correct domains as a part of url, so that Frontend
Websites could output these links as-is.</p>
<div class="admonition info">
<p class="admonition-title">Example of multi-site URL rendering</p>
<p>For example, if we have:</p>
<ul>
<li>2 sites <code>first.com</code> and <code>second.com</code> </li>
<li>2 pages <code>page1</code> and <code>page2</code></li>
<li><code>page1</code> has a link to <code>page2</code></li>
<li><code>page1</code> belongs to <code>first.com</code></li>
<li><code>page2</code> belongs to both <code>first.com</code> and <code>second.com</code>; the <em>primary site</em> 
  is set to <code>second.com</code></li>
</ul>
<p>When the visitor is on the page <code>first.com/page1</code> and follows the link <code>/page2</code>
she should end up on <code>first.com/page2</code> and not <code>second.com/page2</code>. This is
because she is currently on <code>first.com</code> domain and <em>continues</em> browsing the 
same domain. </p>
<p>And if the visitor comes from Google search to <code>page2</code>, she should end up at
<code>second.com/page2</code>, because <code>second.com</code> is a <em>primary site</em> for <code>page2</code>.</p>
</div>
<p>This is just an example of the part of the problem. There are more use-cases and
they are explained below. </p>
<p>For content exposed through API, the links may come from different places and we
need to be able to extract internal entity id:</p>
<ul>
<li>For link fields, this should be fairly straightforward: the user enters the
link and we have an internal entity id. </li>
<li>For links entered in WYSIWYG, we need to use the LinkIt module so that we 
can extract an internal entity id.</li>
<li>For links entered in WYSIWYG within referenced entities (for example, field on
the paragraph belonging to the page) the API output will contains the path alias.</li>
</ul>
<p>For all links presented to the user: </p>
<ul>
<li>Internal links should be rendered as a relative path. If the link is to a page
available on the current site, either primary or not, render as a relative link.</li>
<li>External links (including links to other sites/section) should be rendered
with an absolute path.</li>
</ul>
<p>For links within WYSIWYG, Drupal has to extract, analyse and replace links
before rendering it through API. For this, we use an enhancer (special piece of
code to manipulate content output before it is rendered through API) to scrape
the content, then render the relevant link.</p>
<details><summary>Implementation details</summary><p>The content is extracted from the raw contents of WYSIWYG filed using 
<em>Link Extractor</em>. </p>
<p><em>Link Extractor</em> scans HTML and extracts all links. This happens before 
Drupal sanitizes WYSIWYG field output. Every extracted link is then passed 
to a <em>Link Resolver</em>.</p>
<p><em>Link Resolver</em> takes node id, loads up the path alias using some complex 
logic (see diagram below) and then swaps it within the <code>href</code>. Resolved URL 
is then passed to <em>Link Replacer</em>.</p>
<p><em>Link Replacer</em> replaces old extracted links with new resolved ones within 
contents of the WYSIWYG field. The processsed field contents is then passed
to API for normal rendering as JSONAPI response. </p>
<p>For links coming from Link fields, the above applies, but starting from 
<em>Link Resolver</em> (there is no HTML to extarct teh link from , so 
<em>Link Extractor</em> is not required).</p>
<p>The following diagram describes URL processing and link resolution in 
detail.</p>
<p><a href="../../assets/tide-url-resolving-pipeline.png"> <img alt="" src="../../assets/tide-url-resolving-pipeline.png" /> </a></p>
</details>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../api/" title="API" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                API
              </span>
            </div>
          </a>
        
        
          <a href="../fields-components/" title="Fields and components" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Fields and components
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2019 Department of Premier and Cabinet of Victoria
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
  <div class="md-footer-social">
    <link rel="stylesheet" href="../../assets/fonts/font-awesome.css">
    
      <a href="https://github.com/dpc-sdp" class="md-footer-social__link fa fa-github-alt"></a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>